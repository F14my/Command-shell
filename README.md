# Лабораторная работа №2

### Упрощённая командная оболочка
- **Цель**: Реализовать на Python оболочку, которая имитирует основные команды Bash.

### Возможности
- Поддерживаемые команды: `pwd`, `ls` (в том числе `-l`), `cd`, `rm`, `cat`, `cp`, `mv`, `zip`, `unzip`, `tar`, `untar`, `grep`, `history`, `undo`.
- Логирование вызовов и сохранение истории команд в JSON-файл.
- Отмена последней операции через `undo`.
- Обработка ошибок и вывод сообщений пользователю.
- Поддержка кавычек и пробелов в аргументах благодаря `shlex`.

## Структура проекта
- `src/main.py` - точка входа в приложение.
- `src/bash.py` - диспетчер команд, который парсит ввод и вызывает соответствующие обработчики.
- `src/modules/` - обработчики конкретных команд (`*handler.py`), а также модуль логирования.
- `src/history/` - менеджер истории и обработчик команды `history`.
- `src/undo/` - реализация механизма отката последней команды.
- `tests/` - тесты, проверяющие работоспособность команд.

## Команды оболочки

### `pwd`
- Показывает абсолютный путь до текущей директории.
- Для удобства в Windows обратные слэши автоматически заменяются на прямые.

### `ls` и `ls -l`
- Без флагов выводит имена файлов и папок текущей директории.
- Флаг `-l` добавляет подробности: тип объекта, права доступа, количество ссылок, владельца, группу, размер и время изменения.
- Путь можно передать аргументом: `ls <folder>`.

### `cd`
- Меняет текущую директорию.
- Без аргументов перемещает в домашний каталог пользователя.
- Поддерживает короткую запись `~` и относительные пути.

### `rm` (`rm [-r] <путь>`)
- Перемещает файлы и каталоги во внутреннюю корзину `.trash`.
- Для директорий требуется флаг `-r`. Перед перемещением вложенных каталогов запрашивает подтверждение.
- Защищает от удаления корня файловой системы и родительской папки проекта.

### `cat`
- Печатает содержимое файла построчно.
- При попытке прочитать директорию - ошибка.

### `cp` (`cp [-r] <источник> <цель>`)
- Копирует файл или директорию в указанное место.
- Флаг `-r` обязателен для копирования директорий;

### `mv` (`mv <источник> <цель>`)
- Перемещает или переименовывает файл/директорию.
- Проверяет наличие исходного пути и доступ на запись в каталог.

### Архивация: `zip` и `tar`
- Оба варианта используют стандартный `shutil.make_archive`.
- Синтаксис: `zip <папка> <архив.zip>` или `tar <папка> <архив.tar>`.
- Если имя архива не указано, используется имя каталога; архив создаётся рядом с исходной папкой.

### Распаковка: `unzip` и `untar`
- `unzip <архив.zip>` и `untar <архив.tar>` извлекают архив в подкаталог, названный как файл без расширения .zip или .tar.

### `grep` (`grep [-r] <шаблон> <путь>`)
- Ищет строки, подходящие под регулярное выражение(регулярное выражение читается также, как и re в python), в файле.
- Без флага `-r` сканирует только файлы верхнего уровня каталога, с `-r` - рекурсивно.
- Выводит путь к файлу, номер строки и саму строку.

### `history`
- Читает JSON-файл истории и выводит последние выполненные команды.
- Принимает необязательный аргумент - количество выводимых записей (по умолчанию 10).

### `undo`
- Отменяет последнюю файловую операцию `cp`, `mv` или `rm`, используя данные из истории.
- В качестве аргумента принимает имя команды; без аргумента ищет последнюю поддерживаемую операцию.

## Тестирование
Запуск тестов:
```bash
python -m unittest
```

## Установка и запуск
1. Склонируйте репозиторий и перейдите в директорию проекта.
2. Создайте виртуальное окружение (например, через `python -m venv .venv`) и активируйте его.
3. Установите зависимости: `pip install -r requirements.txt` или `uv pip install -r requirements.txt`.
4. Запустите оболочку:
    ```bash
    python -m src.main
    ```